<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>توليد بيانات مستخدمين عشوائية</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    button { padding: .5rem 1rem; font-size: 1rem; margin-right: .5rem; }
    pre { background: #f4f4f4; padding: 1rem; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>توليد بيانات مستخدمين عشوائية</h1>
  <p>كل 10 ثوانٍ سيتم إرسال سجل مستخدم جديد إلى الـ API.</p>
  <button id="start">ابدأ الإرسال</button>
  <button id="stop" disabled>أوقف الإرسال</button>

  <h2>آخر مستخدم أُرسل:</h2>
  <pre id="lastJson">لا شيء بعد.</pre>

  <script>
    // عدّل هذا الـ URL إلى endpoint المستخدمين في مشروعك
    const API_URL = 'http://127.0.0.1:8000/user/';

    let intervalId = null;

    // دالة لإنشاء نص عشوائي
    function randomString(length) {
      const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
      let s = '';
      for (let i = 0; i < length; i++) {
        s += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return s;
    }

    // توليد جسم JSON للمستخدم مع كلمة المرور
    function generateUser() {
      const name = randomString(6);
      const pass = randomString(8);
      return {
        username: name,
        email: `${name}@example.com`,
        password: pass,
      };
    }

    async function sendUser() {
      const user = generateUser();
      document.getElementById('lastJson').textContent = JSON.stringify(user, null, 2);
      try {
        const resp = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(user)
        });
        if (!resp.ok) {
          console.error('خطأ في إرسال المستخدم:', resp.status, await resp.text());
        } else {
          console.log('تم إرسال المستخدم بنجاح:', await resp.json());
        }
      } catch (err) {
        console.error('فشل الاتصال بـ API:', err);
      }
    }

    document.getElementById('start').onclick = () => {
      if (!intervalId) {
        sendUser();
        intervalId = setInterval(sendUser, 1);
        document.getElementById('start').disabled = true;
        document.getElementById('stop').disabled = false;
      }
    };

    document.getElementById('stop').onclick = () => {
      clearInterval(intervalId);
      intervalId = null;
      document.getElementById('start').disabled = false;
      document.getElementById('stop').disabled = true;
    };
  </script>
</body>
</html>
