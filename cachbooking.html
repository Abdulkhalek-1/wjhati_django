<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù…ÙˆÙ„Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; direction: rtl; background: #f4f4f4; }
    button { padding: 0.6rem 1.2rem; font-size: 1rem; margin: 0.5rem; cursor: pointer; }
    pre { background: #fff; padding: 1rem; max-width: 100%; overflow-x: auto; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>ğŸ“¦ Ù…ÙˆÙ„Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø² Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø­Ù„Ø§Øª</h1>
  <p>ÙŠÙ‚ÙˆÙ… Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨ØªÙˆÙ„ÙŠØ¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø© Ø¶Ù…Ù† Ù†Ø·Ø§Ù‚ Ø¬ØºØ±Ø§ÙÙŠ Ù…Ø­Ø¯Ø¯.</p>

  <button id="start">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</button>
  <button id="stop" disabled>ğŸ›‘ Ø£ÙˆÙ‚Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</button>

  <h2>ğŸ“„ Ø¢Ø®Ø± Ø­Ø¬Ø²:</h2>
  <pre id="lastJson">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¯.</pre>

  <script>
    const API_URL = 'http://127.0.0.1:8000/cashe-bookings/';
    let intervalId = null;

    const USERS = Array.from({ length: 20 }, (_, i) => i + 1);
    const NOTES = ["Ø¨Ø¯ÙˆÙ† Ù…Ù„Ø§Ø­Ø¸Ø§Øª", "Ø£Ø­Ù…Ù„ Ø­Ù‚ÙŠØ¨Ø©", "Ù…Ø¹ Ø·ÙÙ„", "Ø£Ø­ØªØ§Ø¬ Ù…ÙƒØ§Ù† Ø¥Ø¶Ø§ÙÙŠ", "Ù„Ø§ Ø£Ø±ØºØ¨ ÙÙŠ Ø§Ù„Ø¬Ù„ÙˆØ³ Ù‚Ø±Ø¨ Ø§Ù„Ø¨Ø§Ø¨"];

    function getRandomInRange(min, max) {
      return +(Math.random() * (max - min) + min).toFixed(6);
    }

    function getRandomItem(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function generateLocationRange(latMin, latMax, lngMin, lngMax) {
      return {
        lat: getRandomInRange(latMin, latMax),
        lng: getRandomInRange(lngMin, lngMax)
      };
    }

    function generateBooking() {
      const from = generateLocationRange(15.300, 15.340, 44.190, 44.230); // Ù…Ù†Ø·Ù‚Ø© ÙÙŠ ØµÙ†Ø¹Ø§Ø¡
      let to;
      do {
        to = generateLocationRange(15.310, 15.360, 44.220, 44.260);
      } while (Math.abs(from.lat - to.lat) < 0.003 && Math.abs(from.lng - to.lng) < 0.003); // ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ´Ø§Ø¨Ù‡ Ø§Ù„ÙƒØ¨ÙŠØ±

      const departureTime = new Date(Date.now() + (Math.floor(Math.random() * 6) + 1) * 60 * 60000); // Ù…Ù† Ø³Ø§Ø¹Ø© Ø¥Ù„Ù‰ 6 Ø³Ø§Ø¹Ø§Øª

      const booking = {
        from_location: `${from.lat},${from.lng}`,
        to_location: `${to.lat},${to.lng}`,
        departure_time: departureTime.toISOString(),
        passengers: Math.floor(Math.random() * 3) + 1,
        status: "pending",
        notes: getRandomItem(NOTES),
        user: getRandomItem(USERS)
      };

      return booking;
    }

    async function sendBooking() {
      const booking = generateBooking();
      document.getElementById('lastJson').textContent = JSON.stringify(booking, null, 2);

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(booking)
        });

        const result = await response.text();
        if (!response.ok) {
          console.error('âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:', response.status, result);
        } else {
          console.log('âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:', result);
        }
      } catch (err) {
        console.error('âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ API:', err);
      }
    }

    document.getElementById('start').onclick = () => {
      if (!intervalId) {
        sendBooking(); // Ø£ÙˆÙ„ Ø¥Ø±Ø³Ø§Ù„
        intervalId = setInterval(sendBooking, 11); // ÙƒÙ„ 3 Ø«ÙˆØ§Ù†Ù
        document.getElementById('start').disabled = true;
        document.getElementById('stop').disabled = false;
      }
    };

    document.getElementById('stop').onclick = () => {
      clearInterval(intervalId);
      intervalId = null;
      document.getElementById('start').disabled = false;
      document.getElementById('stop').disabled = true;
    };
  </script>
</body>
</html>
