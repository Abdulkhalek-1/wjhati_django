<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>توليد بيانات حجز واقعية</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; direction: rtl; background: #fafafa; }
    button { padding: 0.6rem 1.2rem; font-size: 1rem; margin: 0.5rem 0.5rem 0.5rem 0; cursor: pointer; }
    pre { background: #eee; padding: 1rem; max-width: 100%; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>مولد بيانات حجز لاختبار النظام</h1>
  <p>يقوم هذا النموذج بإرسال حجوزات واقعية عشوائية إلى الـ API المحلي.</p>

  <button id="start">ابدأ الإرسال</button>
  <button id="stop" disabled>أوقف الإرسال</button>

  <h2>آخر حجز أُرسل:</h2>
  <pre id="lastJson">لم يتم الإرسال بعد.</pre>

  <script>
    const API_URL = 'http://127.0.0.1:8000/cashe-bookings/';
    let intervalId = null;

    const USERS = Array.from({ length: 2000 }, (_, i) => i + 1); // 200 مستخدم
    const NOTES = ["بدون ملاحظات", "أحمل حقيبة كبيرة", "أرغب في الجلوس قرب النافذة", "سأسافر مع طفل", "أحتاج مكان للكرسي المتحرك"];

    function getRandomInRange(min, max) {
      return (Math.random() * (max - min) + min).toFixed(6);
    }

    function getRandomItem(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function generateBooking() {
      // توليد مواقع من وإلى ضمن مناطق محتملة في صنعاء مثلاً
      const fromLat = getRandomInRange(15.300000, 15.360000);
      const fromLng = getRandomInRange(44.170000, 44.250000);
      const toLat = getRandomInRange(15.310000, 15.390000);
      const toLng = getRandomInRange(44.200000, 44.280000);

      const departureTime = new Date(Date.now() + Math.floor(Math.random() * 3 * 3600000)); // خلال 3 ساعات
      const passengers = Math.floor(Math.random() * 4) + 1; // بين 1 و 4 ركاب

      return {
        from_location: `${fromLat},${fromLng}`,
        to_location: `${toLat},${toLng}`,
        departure_time: departureTime.toISOString(),
        passengers: passengers,
        status: "pending",
        notes: getRandomItem(NOTES),
        user: getRandomItem(USERS)
      };
    }

    async function sendBooking() {
      const booking = generateBooking();
      document.getElementById('lastJson').textContent = JSON.stringify(booking, null, 2);

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(booking)
        });

        const result = await response.text();
        if (!response.ok) {
          console.error('خطأ في الإرسال:', response.status, result);
        } else {
          console.log('تم الإرسال:', result);
        }
      } catch (err) {
        console.error('فشل الاتصال بالـ API:', err);
      }
    }

    document.getElementById('start').onclick = () => {
      if (!intervalId) {
        sendBooking(); // أول إرسال مباشر
        intervalId = setInterval(sendBooking, 1); // كل 3 ثوانٍ
        document.getElementById('start').disabled = true;
        document.getElementById('stop').disabled = false;
      }
    };

    document.getElementById('stop').onclick = () => {
      clearInterval(intervalId);
      intervalId = null;
      document.getElementById('start').disabled = false;
      document.getElementById('stop').disabled = true;
    };
  </script>
</body>
</html>
