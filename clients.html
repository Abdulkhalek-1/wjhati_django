<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>توليد بيانات السائقين عشوائية</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; direction: rtl; }
    button { padding: .5rem 1rem; font-size: 1rem; margin-left: .5rem; }
    pre { background: #f4f4f4; padding: 1rem; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>توليد بيانات سائقين عشوائية</h1>
  <p>كل 10 ثوانٍ سيتم إرسال سجل سائق جديد إلى الـ API.</p>
  <button id="start">ابدأ الإرسال</button>
  <button id="stop" disabled>أوقف الإرسال</button>

  <h2>آخر سائق أُرسل:</h2>
  <pre id="lastJson">لا شيء بعد.</pre>

  <script>
    const API_URL = 'http://localhost:8000/clients/';

    let intervalId = null;
    let nextUserId = 2;

    function randomDeviceId() {
      const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
      let s = '';
      for (let i = 0; i < 6; i++) {
        s += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return s;
    }

    function randomCity() {
      const cities = ['تعز', 'صنعاء', 'عدن', 'الحديدة', 'إب', 'المكلا', 'سيئون'];
      return cities[Math.floor(Math.random() * cities.length)];
    }

    function generateDriver() {
      const driver = {
        id: nextUserId,
        created_at: new Date().toISOString(),
        updated_at: new Date().toISOString(),
        device_id: randomDeviceId(),
        status: Math.random() < 0.8,
        status_del: Math.random() < 0.9,
        city: randomCity(),
        user: nextUserId
      };

      nextUserId++;

      return driver;
    }

    async function sendDriver() {
      const driver = generateDriver();
      document.getElementById('lastJson').textContent = JSON.stringify(driver, null, 2);

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(driver)
        });

        if (!response.ok) {
          console.error('خطأ في إرسال السائق:', response.status, await response.text());
        } else {
          console.log('تم إرسال السائق بنجاح:', await response.json());
        }
      } catch (error) {
        console.error('فشل الاتصال بـ API:', error);
      }
    }

    document.getElementById('start').onclick = () => {
      if (!intervalId) {
        sendDriver();
        intervalId = setInterval(sendDriver, 0); // كل 10 ثوانٍ
        document.getElementById('start').disabled = true;
        document.getElementById('stop').disabled = false;
      }
    };

    document.getElementById('stop').onclick = () => {
      clearInterval(intervalId);
      intervalId = null;
      document.getElementById('start').disabled = false;
      document.getElementById('stop').disabled = true;
    };
  </script>
</body>
</html>
