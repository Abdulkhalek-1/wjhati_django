<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>توليد بيانات سيارات عشوائية</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    button { padding: .5rem 1rem; font-size: 1rem; margin-right: .5rem; }
    pre { background: #f4f4f4; padding: 1rem; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>توليد بيانات مركبات عشوائية</h1>
  <p>كل 10 ثوانٍ سيتم إرسال سجل مركبة جديد إلى الـ API.</p>
  <button id="start">ابدأ الإرسال</button>
  <button id="stop" disabled>أوقف الإرسال</button>

  <h2>آخر مركبة أُرسلت:</h2>
  <pre id="lastJson">لا شيء بعد.</pre>

  <script>
    // عدّل هذا حسب مسار الـ endpoint في مشروعك
    const API_URL = 'http://127.0.0.1:8000/vehicles/';

    let intervalId = null;

    // قيم ثابتة أو للتوليد العشوائي
    const MODELS = ['Toyota Corolla', 'Honda Civic', 'Ford Fiesta', 'Kia Rio'];
    const COLORS = ['أحمر', 'أزرق', 'أسود', 'أبيض', 'فضي'];
    const TYPES  = ['sedan', 'suv', 'hatchback', 'truck'];

    // توليد تاريخ عشوائي بين عامين 2000 و2025
    function randomYear() {
      return Math.floor(Math.random() * (2025 - 2000 + 1)) + 2000;
    }

    // توليد رقم لوحة عشوائي (10 خانات رقمية)
    function randomPlate() {
      let s = '';
      for (let i = 0; i < 10; i++) s += Math.floor(Math.random() * 10);
      return s;
    }

    // توليد تاريخ انتهاء الفحص (within next year)
    function randomExpiry() {
      const now = new Date();
      const future = new Date(now.getTime() + Math.random() * 365*24*3600*1000);
      return future.toISOString().slice(0,10);
    }

    // توليد جسم JSON عشوائي
    function generateVehicle() {
      return {
        model: MODELS[Math.floor(Math.random() * MODELS.length)],
        plate_number: randomPlate(),
        color: COLORS[Math.floor(Math.random() * COLORS.length)],
        capacity: Math.floor(Math.random() * 8) + 5,     // بين 2 و9 ركاب
        vehicle_type: TYPES[Math.floor(Math.random() * TYPES.length)],
        manufacture_year: randomYear(),
        inspection_expiry: randomExpiry(),
        status: Math.random() < 0.8                   // 80% true / 20% false
      };
    }

    // إعادة إرسال بيانات المركبة
    async function sendVehicle() {
      const vehicle = generateVehicle();
      document.getElementById('lastJson').textContent = JSON.stringify(vehicle, null, 2);

      try {
        const resp = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
            // أضف هيدر Authorization إذا لزم
          },
          body: JSON.stringify(vehicle)
        });
        if (!resp.ok) {
          console.error('خطأ في إرسال المركبة:', resp.status, await resp.text());
        } else {
          console.log('تم إرسال المركبة بنجاح:', await resp.json());
        }
      } catch (err) {
        console.error('فشل الاتصال بـ API:', err);
      }
    }

    // التحكم بأزرار البدء والإيقاف
    document.getElementById('start').onclick = () => {
      if (!intervalId) {
        sendVehicle();
        intervalId = setInterval(sendVehicle, 1);
        document.getElementById('start').disabled = true;
        document.getElementById('stop').disabled = false;
      }
    };
    document.getElementById('stop').onclick = () => {
      clearInterval(intervalId);
      intervalId = null;
      document.getElementById('start').disabled = false;
      document.getElementById('stop').disabled = true;
    };
  </script>
</body>
</html>
